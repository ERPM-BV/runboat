resources:
  {% if mode == 'deployment' -%}
  - deployment.yaml
  - service.yaml
  - ingress.yaml
  {% elif mode == "initialize" -%}
  - initialize.yaml
  {% elif mode == "cleanup" -%}
  - cleanup.yaml
  {% endif %}

namespace: {{ namespace }}

namePrefix: "{{ build_name }}-"

commonLabels:
  runboat/build: "{{ build_name }}"

commonAnnotations:
  runboat/repo: "{{ repo }}"
  runboat/target-branch: "{{ target_branch }}"
  runboat/pr: "{{ pr if pr else '' }}"
  runboat/git-commit: "{{ git_commit }}"

images:
  - name: odoo
    newName: "{{ image_name }}"
    newTag: "{{ image_tag }}"

secretGenerator:
  - name: odoosecretenv
    literals:
      - PGPASSWORD={{ pgpassword }}
      - ADMIN_PASSWD={{ admin_passwd }}

configMapGenerator:
  - name: odooenv
    literals:
      - PGHOST={{ pghost }}
      - PGPORT={{ pgport }}
      - PGUSER={{ pguser }}
      - PGNAME={{ pgname }}
      - PGDATABASE={{ pgdatabase }}
      - ADDONS_DIR=/build
      - RUNBOAT_GIT_REPO=https://github.com/{{ repo }}
      - RUNBOAT_GIT_REF={{ git_commit }}
      {%- for key, value in build_env.items() %}
      - {{ key }}={{ value }}
      {%- endfor %}
  - name: runboat-scripts
    files:
      - runboat-clone-and-install.sh
      - runboat-initialize.sh
      - runboat-cleanup.sh
      - runboat-start.sh
  {% if mode == 'deployment' -%}
  - name: vars
    literals:
      - HOSTNAME={{ hostname }}
  {% endif %}

generatorOptions:
  disableNameSuffixHash: true

{% if mode == 'deployment' -%}
vars:
  - name: HOSTNAME
    objref:
      name: vars
      kind: ConfigMap
      apiVersion: v1
    fieldref:
      fieldpath: data.HOSTNAME
{% endif %}
